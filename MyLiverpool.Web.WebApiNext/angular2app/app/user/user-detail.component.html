<div class="container-fluid" *ngIf="item">
    <h2>
        <span [textContent]="item.userName"></span>
        <span *ngIf="roles.isLogined && !roles.isSelf(item.id)">
            <a role="button" (click)="writePm()"><span class="glyphicon glyphicon-envelope"></span></a>
        </span>
    </h2>
    <pm-reply *ngIf="selectedUserId" [userId]="selectedUserId" (close)="closePmWindow($event);" [userName]="item.userName"></pm-reply>
    <div class="row">
        <div class="col-xs-2 col-sm-2">
            <img class="avatar" [src]="item.photo" [alt]="item.userName"/>
        </div>
        <div class="col-xs-10 col-sm-10">
            <div *ngIf="roles.isSelf(item.id) || roles.isModerator">
                <label for="update-avatar-input" 
                       *ngIf="roles.isSelf(item.id)"
                       class="btn btn-info">Обновить аватар</label>
                <input type="file"
                       class="hidden"
                       accept="image/*" 
                       (change)="onChangeAvatar($event)"
                       id="update-avatar-input"/>
                <button class="btn btn-warning" (click)="resetAvatar()">
                    Сбросить аватар
                </button>
                <button *ngIf="roles.isSelf(item.id)" class="btn btn-danger" [routerLink]="['/changePassword']">Изменить пароль</button>
                <br><br>
            </div>
        </div>
    </div>

    <div class="form-horizontal" role="form">
        <div class="form-group">
            <label class="col-sm-2 control-label">Логин</label>
            <div class="col-sm-10">
                <span class="form-control" [textContent]="item.userName"></span>
            </div>
        </div>
        <div *ngIf="roles.isModerator && !roles.isSelf(item.id)" class="form-group">
            <label class="col-xs-2 col-sm-2 control-label">Блокировка</label>
            <div class="col-xs-10 col-sm-10" >
                <form *ngIf="!item.lockoutEnd" class="form-inline" name="banForm" role="form" [formGroup]="banForm" (ngSubmit)="onSubmitBan()">                    
                        <input min="0" type="number" placeholder="Количество дней" class="form-control" formControlName="banDaysCount" />
                        <button class="btn btn-danger" type="submit" [disabled]="!banForm.valid">Забанить</button>
                </form>
                <div class="col-xs-12 col-sm-12 flex-container" *ngIf="item.lockoutEnd">
                    <span class="col-xs-10 col-sm-10 flex-vertical-center">Активность заблокирована до &nbsp;<b [textContent]="item.lockoutEnd | date:'medium'"></b></span>
                    <button class="btn btn-success" *ngIf="roles.isMainModerator" (click)="unban()">Снять бан</button>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-2 col-sm-2 control-label">Группа:</label>
            <div class="col-xs-10 col-sm-10">
                <span *ngIf="!roles.isAdminAssistant || roles.isSelf(item.id)" class="form-control" [textContent]="item.roleGroupName"></span>
 
                <form *ngIf="roles.isAdminAssistant && !roles.isSelf(item.id)" class="form-inline" name="roleForm" role="form" [formGroup]="roleForm" (ngSubmit)="onSubmit(roleForm.value)">
                    <select class="form-control" name="roleGroup" formControlName="roleGroupId">
                        <option *ngFor="let roleGroup of roleGroups" [value]="roleGroup.id" [textContent]="roleGroup.name"></option>
                    </select>
                    <button type="submit" [disabled]="!roleForm.valid" class="btn btn-default">Сохранить</button>
                </form>
            </div>
        </div>
        <div class="form-group" *ngIf="roles.isSelf(item.id) || roles.isAdminAssistant">
            <label class="col-xs-2 col-sm-2 control-label" *ngIf="item.emailConfirmed">Почта</label>
            <label class="col-xs-2 col-sm-2 control-label text-danger" tooltip="Почта не подтверждена" *ngIf="!item.emailConfirmed">Почта</label>
            <div class="col-xs-10 col-sm-10">
                <span class="form-control" [textContent]="item.email"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-2 col-sm-2 control-label">Последний вход </label>
            <div class="col-xs-10 col-sm-10">
                <span class="form-control" [textContent]="item.lastModifiedOn | date:'medium'"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-2 col-sm-2 control-label">Дата регистрации</label>
            <div class="col-xs-10 col-sm-10">
                <span class="form-control" [textContent]="item.registrationDate | date:'medium'"></span>
            </div>
        </div>
        <div class="form-group" *ngIf="item.fullName">
            <label class="col-xs-2 col-sm-2 control-label">Полное имя</label>
            <div class="col-xs-10 col-sm-10">
                <span class="form-control" [textContent]="item.fullName"></span>
            </div>
        </div>
        <div class="form-group" *ngIf="item.birthday">
            <label class="col-xs-2 col-sm-2 control-label">День рождения</label>
            <div class="col-xs-10 col-sm-10">
                <span class="form-control" [textContent]="item.birthday | date:'longDate'"></span>
            </div>
        </div>
        <div class="form-group" *ngIf="item.gender">
            <label class="col-xs-2 col-sm-2 control-label">Пол</label>
            <div class="col-xs-10 col-sm-10">
                <span class="form-control" *ngIf="item.gender">Девушка</span>
                <span class="form-control" *ngIf="!item.gender">Парень</span>
            </div>
        </div>
        <div>
            <ul class="list-inline">
                <li *ngIf="item.newsCount > 0">
                    <a [routerLink]="['/news']" [queryParams]="{page: 1, userName: item.userName}">Новости(<span [textContent]="item.newsCount"></span>)</a>
                </li>
                <li>|</li>
                <li *ngIf="item.blogsCount > 0">
                    <a [routerLink]="['/blog']" [queryParams]="{page: 1, userName: item.userName}">Блоги(<span [textContent]="item.blogsCount"></span>)</a>
                </li>
            </ul>
        </div>
    </div>
</div>

<!--script type="text/ng-template" id="changeRoleConfirmation.html">
    <div class="modal-header">
        <h3 class="modal-title">Редактирование роли</h3>
    </div>
    <div class="modal-body">
        Изменить?
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" type="button" ng-click="vm.ok()">Изменить</button>
        <button class="btn btn-default" type="button" ng-click="vm.cancel()">Отмена</button>
    </div>
</!--script>

<script type="text/ng-template" id="banConfirmation.html">
    <div class="modal-header">
        <h3 class="modal-title"></h3>
    </div>
    <div class="modal-body">
        Забанить?
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-default" ng-click="vm.ok()">Забанить</button>
        <button type="button" class="btn btn-primary" ng-click="vm.cancel()">Отмена</button>
    </div>
</script>-->