<div class="container-fluid" *ngIf="item">
    <h2>
        <span [textContent]="item.userName"></span>
        <span *ngIf="roles.isLogined && !roles.isSelf(item.id)">
            <a role="button" (click)="writePm()"><span class="glyphicon glyphicon-envelope"></span></a>
        </span>
    </h2>
    <pm-reply *ngIf="selectedUserId" [userId]="selectedUserId" (close)="closePmWindow($event);" [userName]="item.userName"></pm-reply>
    <div class="row">
        <div class="col-xs-4 col-sm-4">
            <img class="avatar" [src]="item.photo" [alt]="item.userName"/>
        </div>
        <div class="col-xs-8 col-sm-8">
            <div *ngIf="roles.isSelf(item.id) || roles.isModerator">
                <label for="update-avatar-input" 
                       *ngIf="roles.isSelf(item.id)"
                       class="btn btn-info">Обновить аватар</label>
                <input type="file"
                       class="hidden"
                       accept="image/*" 
                       (change)="onChangeAvatar($event)"
                       id="update-avatar-input"/>
                <button class="btn btn-warning" (click)="resetAvatar()">
                    Сбросить аватар
                </button>
                <button md-raised-button color="warn" *ngIf="roles.isSelf(item.id)" [routerLink]="['/changePassword']">Изменить пароль</button>
                <button md-raised-button *ngIf="roles.isSelf(item.id)" [routerLink]="['./settings']">Изменить настройки</button>
                <button md-raised-button *ngIf="roles.isSelf(item.id)" [routerLink]="['./edit']">Изменить профиль</button>
                <br><br>
            </div>
        </div>
    </div>

    <div class="form-horizontal" role="form">
        <div class="form-group">
            <label class="col-sm-2 control-label">Логин</label>
            <div class="col-sm-10">
                <span class="form-control" [textContent]="item.userName"></span>
            </div>
        </div>
        <div *ngIf="roles.isModerator && !roles.isSelf(item.id)" class="form-group">
            <label class="col-sm-2 control-label">Блокировка</label>
            <div class="col-sm-10" >
                <form *ngIf="!item.lockoutEnd" class="form-inline" name="banForm" role="form" [formGroup]="banForm" (ngSubmit)="onSubmitBan()">                    
                        <input min="0" type="number" placeholder="Количество дней" class="form-control" formControlName="banDaysCount" />
                        <button class="btn btn-danger" type="submit" [disabled]="!banForm.valid">Забанить</button>
                </form>
                <div class="col-xs-12 col-sm-12 flex-container" *ngIf="item.lockoutEnd">
                    <span class="col-xs-10 col-sm-10 flex-vertical-center">Активность заблокирована до &nbsp;<b [textContent]="item.lockoutEnd | date:'medium'"></b></span>
                    <button class="btn btn-success" *ngIf="roles.isMainModerator" (click)="unban()">Снять бан</button>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">Группа</label>
            <div class="col-sm-10">
                <span *ngIf="!roles.isAdminAssistant || roles.isSelf(item.id)" class="form-control" [textContent]="item.roleGroupName"></span>
 
                <form *ngIf="roles.isAdminAssistant && !roles.isSelf(item.id)" class="form-inline" name="roleForm" role="form" [formGroup]="roleForm" (ngSubmit)="onSubmit()">
                    <select class="form-control" name="roleGroup" formControlName="roleGroupId">
                        <option *ngFor="let roleGroup of roleGroups" [value]="roleGroup.id" [textContent]="roleGroup.name"></option>
                    </select>
                    <button type="submit" [disabled]="!roleForm.valid" class="btn btn-default">Сохранить</button>
                </form>
            </div>
        </div>
        <div class="form-group" *ngIf="roles.isSelf(item.id) || roles.isAdminAssistant">
            <label class="col-sm-2 control-label" *ngIf="item.emailConfirmed">Почта</label>
            <label class="col-sm-2 control-label text-danger" tooltip="Почта не подтверждена" *ngIf="!item.emailConfirmed">Почта</label>
            <div class="col-sm-10">
                <span class="form-control" [textContent]="item.email"></span>
            </div>
        </div>       
        <div class="form-group" *ngIf="roles.isAdminAssistant">
            <label class="col-sm-2 control-label">Ip</label>
            <div class="col-sm-10">
                <span class="form-control" [textContent]="item.ip"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">Последний вход </label>
            <div class="col-sm-10">
                <span class="form-control" [textContent]="item.lastModifiedOn | date:'medium'"></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">Дата регистрации</label>
            <div class="col-sm-10">
                <span class="form-control" [textContent]="item.registrationDate | date:'medium'"></span>
            </div>
        </div>
        <div class="form-group" *ngIf="item.fullName">
            <label class="col-sm-2 control-label">Полное имя</label>
            <div class="col-sm-10">
                <span class="form-control" [textContent]="item.fullName"></span>
            </div>
        </div>
        <!--div class="form-group" *ngIf="item.birthday">
            <label class="col-xs-2 col-sm-2 control-label">День рождения</label>
            <div class="col-xs-10 col-sm-10">
                <span class="form-control" [textContent]="item.birthday | date:'longDate'"></span>
            </div>
        </!--div-->
        <div class="form-group" *ngIf="item.gender">
            <label class="col-sm-2 control-label">Пол</label>
            <div class="col-sm-10">
                <span class="form-control" *ngIf="item.gender">Девушка</span>
                <span class="form-control" *ngIf="!item.gender">Парень</span>
            </div>
        </div>
        <div>
            <ul class="list-inline">
                <li *ngIf="item.newsCount > 0">
                    <a [routerLink]="['/news']" [queryParams]="{page: 1, userName: item.userName}">Новости(<span [textContent]="item.newsCount"></span>)</a>
                </li>
                <li>|</li>
                <li *ngIf="item.blogsCount > 0">
                    <a [routerLink]="['/blogs']" [queryParams]="{page: 1, userName: item.userName}">Блоги(<span [textContent]="item.blogsCount"></span>)</a>
                </li>   
                <li *ngIf="item.commentsCount > 0">
                    <a [routerLink]="['/materialComments']" [queryParams]="{page: 1, userId: item.id}">Комментарии(<span [textContent]="item.commentsCount"></span>)</a>
                </li>
            </ul>   
        </div>
    </div>
</div>